#!/usr/bin/env ruby
require 'gli'
require 'football_cli'

include GLI::App

program_desc 'Football scores for geeks.'

version FootballCli::VERSION

subcommand_option_handling :normal
arguments :strict

command :show do |c|
  c.desc 'Specify league code'
  c.flag [:l, :league]

  c.desc 'Specify match day'
  c.flag [:md, :match_day]

  c.desc 'Specify team code'
  c.flag [:t, :team]

  c.switch [:p, :players]
  c.switch [:f, :fixtures]

  c.action do |global_options, options, args|
    league = options[:league]
    match_day = options[:match_day]
    players = options[:players]
    fixtures = options[:fixtures]
    team = options[:team]

    case
    when league, match_day
      @handler.league_table(league, match_day)
    when team && players, fixtures
      if players
        @handler.team_players(team)
      elsif fixtures
        @handler.team_fixtures(team)
      end
    else
      puts 'Please run help to see available flags and switches'
    end
  end
end

desc 'Display live score'
command :live do |c|
  c.action do |global_options,options,args|
    @handler.live_scores
  end
end

pre do |global,command,options,args|
  @handler ||= FootballCli::Handler.new
end

post do |global,command,options,args|
  # Post logic here
  # Use skips_post before a command to skip this
  # block on that command only
end

on_error do |exception|
  # Error logic here
  # return false to skip default error handling
  puts "----- errors: #{exception.backtrace}"
  true
end

exit run(ARGV)
